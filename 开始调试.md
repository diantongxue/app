# 开始调试指南

## 🎉 开发完成

所有核心功能已经开发完成，现在可以开始调试了！

## 📋 调试前准备

### 1. 检查依赖安装

**后端依赖**
```bash
cd backend
npm install
```

**前端依赖**
```bash
cd frontend
npm install
```

### 2. 启动服务

**启动后端（终端1）**
```bash
cd backend
npm run dev
```

应该看到：
```
[时间] [Server] 服务器启动成功，端口: 3001
[时间] [Server] WebSocket服务: ws://localhost:3001
[时间] [Server] HTTP API: http://localhost:3001/api
```

**启动前端（终端2）**
```bash
cd frontend
npm run dev
```

应该看到：
```
  VITE v5.x.x  ready in xxx ms

  ➜  Local:   http://localhost:8000/
  ➜  Network: use --host to expose
```

### 3. 访问系统

打开浏览器访问：http://localhost:8000

## 🔍 功能测试

### 测试1: 日志功能

1. 打开任意页面（如设备列表）
2. 查看页面底部的日志框
3. 测试功能：
   - ✅ 查看日志是否正常显示
   - ✅ 点击"复制"按钮，粘贴到文本编辑器查看
   - ✅ 点击"清空"按钮，日志应该被清空

### 测试2: 后端API

在浏览器或Postman中测试：

1. **健康检查**
   ```
   GET http://localhost:3001/api/health
   ```

2. **获取日志**
   ```
   GET http://localhost:3001/api/logs
   ```

3. **获取设备列表**
   ```
   GET http://localhost:3001/api/device/list
   ```

4. **获取数据列表**
   ```
   GET http://localhost:3001/api/data/list
   ```

### 测试3: WebSocket连接

1. 打开浏览器控制台（F12）
2. 访问设备列表页面
3. 查看控制台，应该看到WebSocket连接成功的日志
4. 在Network标签页查看WebSocket连接

### 测试4: 前端页面

依次访问以下页面，检查是否正常加载：

1. **设备列表** - `/device/list`
   - 应该显示设备列表表格
   - 底部有日志框

2. **设备控制** - `/device/control/:id`（需要设备ID）
   - 应该显示屏幕显示区域和控制面板
   - 底部有日志框

3. **数据列表** - `/data/list`
   - 应该显示数据列表表格
   - 底部有日志框

4. **数据可视化** - `/data/visualization`
   - 应该显示统计卡片和图表
   - 底部有日志框

5. **数据详情** - `/data/detail/:id`（需要数据ID）
   - 应该显示数据详情
   - 底部有日志框

## 🐛 常见问题排查

### 问题1: 后端启动失败

**可能原因：**
- 端口3001被占用
- 依赖未安装

**解决方法：**
```bash
# 检查端口占用
lsof -i :3001

# 修改端口（在backend/src/index.ts中）
const PORT = process.env.PORT || 3002;
```

### 问题2: 前端启动失败

**可能原因：**
- 端口8000被占用
- 依赖未安装

**解决方法：**
```bash
# 检查端口占用
lsof -i :8000

# 清理并重新安装
rm -rf node_modules package-lock.json
npm install
```

### 问题3: WebSocket连接失败

**可能原因：**
- 后端未启动
- 跨域问题
- 网络问题

**解决方法：**
1. 确认后端服务已启动
2. 检查浏览器控制台错误信息
3. 检查后端日志

### 问题4: 页面显示异常

**可能原因：**
- 依赖版本冲突
- 缓存问题

**解决方法：**
```bash
# 清理缓存
rm -rf node_modules .umi
npm install
npm run dev
```

## 📝 调试日志

### 如何获取日志

1. **前端日志**
   - 在每个页面的日志框中查看
   - 点击"复制"按钮复制所有日志
   - 粘贴给我查看

2. **后端日志**
   - 在终端查看控制台输出
   - 或访问 `GET http://localhost:3001/api/logs` 获取

3. **浏览器控制台**
   - 按F12打开开发者工具
   - 查看Console标签页
   - 查看Network标签页（WebSocket连接）

### 日志格式

```
[2024-12-XX HH:mm:ss] [级别] 日志内容
```

级别：
- `INFO` - 信息（蓝色）
- `WARN` - 警告（黄色）
- `ERROR` - 错误（红色）

## 🚀 下一步

1. **测试所有功能**
   - 按照上面的测试清单逐一测试
   - 记录遇到的问题

2. **开发手机App**
   - 参考 `android-app/README.md`
   - 在Android Studio中创建项目
   - 实现WebSocket连接和功能

3. **功能完善**
   - 根据测试结果修复问题
   - 优化用户体验
   - 添加错误处理

## 💡 提示

- 所有页面都有日志框，方便调试
- 遇到问题先查看日志
- 可以复制日志发给我分析
- 后端和前端都需要运行才能完整测试

## 📞 需要帮助？

如果遇到问题：
1. 查看日志（前端日志框 + 后端控制台）
2. 复制相关日志
3. 描述问题现象
4. 发给我分析

祝调试顺利！🎉

